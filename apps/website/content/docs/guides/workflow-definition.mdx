---
title: Workflow Definition
description: Define type-safe workflows with defineWorkflow()
---

import { Tab, Tabs } from 'fumadocs-ui/components/tabs';

## Overview

Workflows are defined using `defineWorkflow()` from the `agentcmd-workflows` package. This provides a type-safe API for orchestrating AI agents, git operations, CLI commands, and more.

## Basic Structure

```typescript
import { defineWorkflow } from "agentcmd-workflows";

export default defineWorkflow(
  {
    id: "my-workflow",
    name: "My Workflow",
    description: "What this workflow does",
    phases: ["setup", "execute", "cleanup"],
  },
  async ({ event, step }) => {
    // Workflow implementation
  }
);
```

## Configuration Object

{/* AUTO-GENERATED:workflow-config-api */}
### Workflow Config Properties

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `id` | `string` | ✅ | Unique identifier for the workflow |
| `name` | `string` | ❌ | Display name (defaults to id) |
| `description` | `string` | ❌ | Human-readable description |
| `phases` | `string[]` | ❌ | Phase identifiers for organization |
| `argsSchema` | `JSONSchema` | ❌ | JSON Schema for event arguments |

{/* /AUTO-GENERATED:workflow-config-api */}

## Function Parameters

The workflow function receives a context object with:

{/* AUTO-GENERATED:workflow-context-api */}
### Workflow Context

| Property | Type | Description |
|----------|------|-------------|
| `event` | `Event` | Inngest event with trigger data |
| `step` | `ExtendedStep` | Extended step methods for execution |

### Event Object

```typescript
interface Event {
  data: {
    projectPath?: string;
    args?: InferredFromSchema;
    [key: string]: unknown;
  };
}
```

{/* /AUTO-GENERATED:workflow-context-api */}

## Step Methods

The `step` object provides methods for workflow operations:

{/* AUTO-GENERATED:step-methods-api */}
### Core Step Methods

| Method | Purpose | Return Type |
|--------|---------|-------------|
| `step.phase()` | Group steps into phases | `Promise<void>` |
| `step.agent()` | Execute AI agent (Claude/Codex/Gemini) | `Promise<AgentStepResult>` |
| `step.ai()` | AI text/structured generation | `Promise<AiStepResult>` |
| `step.cli()` | Shell command execution | `Promise<CliStepResult>` |
| `step.git()` | Git operations (commit/branch/pr) | `Promise<GitStepResult>` |
| `step.artifact()` | Upload files/directories | `Promise<void>` |
| `step.annotation()` | Progress notes | `Promise<void>` |
| `step.run()` | Generic function execution | `Promise<T>` |
| `step.sleep()` | Sleep for duration | `Promise<void>` |

{/* /AUTO-GENERATED:step-methods-api */}

## Complete Example

<Tabs items={['Basic', 'With Phases', 'Full']}>
  <Tab value="Basic">
    ```typescript
    import { defineWorkflow } from "agentcmd-workflows";

    export default defineWorkflow(
      {
        id: "hello-world",
        name: "Hello World",
      },
      async ({ event, step }) => {
        await step.annotation("start", {
          message: "Starting workflow",
        });

        await step.cli("greet", {
          command: "echo 'Hello, World!'",
        });

        return { success: true };
      }
    );
    ```
  </Tab>

  <Tab value="With Phases">
    ```typescript
    import { defineWorkflow } from "agentcmd-workflows";

    export default defineWorkflow(
      {
        id: "build-and-test",
        phases: ["build", "test"],
      },
      async ({ event, step }) => {
        await step.phase("build", async () => {
          await step.cli("install", {
            command: "npm install",
          });

          await step.cli("build", {
            command: "npm run build",
          });
        });

        await step.phase("test", async () => {
          await step.cli("test", {
            command: "npm test",
          });
        });

        return { success: true };
      }
    );
    ```
  </Tab>

  <Tab value="Full">
    ```typescript
    import { defineWorkflow } from "agentcmd-workflows";

    export default defineWorkflow(
      {
        id: "example-basic-workflow",
        name: "Example Basic Workflow",
        description: "Demonstrates workflow features",
        phases: ["setup", "build", "test", "deploy"],
      },
      async ({ event, step }) => {
        const projectPath = event.data.projectPath as string;

        await step.phase("setup", async () => {
          await step.annotation("setup-start", {
            message: "Starting setup",
          });

          await step.cli("check-project", {
            command: "ls -la",
            cwd: projectPath,
          });

          await step.sleep("wait", "2s");
        });

        await step.phase("build", async () => {
          await step.cli("lint", {
            command: "npm run lint",
            cwd: projectPath,
          });

          await step.cli("build", {
            command: "npm run build",
            cwd: projectPath,
          });

          await step.artifact("build-summary", {
            name: "build-summary.txt",
            type: "text",
            content: "Build completed successfully",
          });
        });

        await step.phase("test", async () => {
          await step.cli("test", {
            command: "npm test",
            cwd: projectPath,
          });
        });

        await step.phase("deploy", async () => {
          await step.git("commit-changes", {
            operation: "commit",
            message: "chore: workflow execution",
          });

          await step.cli("deploy", {
            command: "npm run deploy",
            cwd: projectPath,
          });
        });

        return {
          success: true,
          completedAt: new Date().toISOString(),
        };
      }
    );
    ```
  </Tab>
</Tabs>

## File Location

Workflows must be placed in:

```
.agent/workflows/definitions/my-workflow.ts
```

Each workflow should export a single workflow definition as the default export.

## Type Safety

The workflow definition is fully type-safe:

- Phase names are validated at compile time
- Step method signatures enforce correct config objects
- Return types are inferred automatically
- Arguments are validated via JSON Schema

## Next Steps

- [Type-Safe Arguments](/docs/guides/type-safe-arguments) - Define and validate workflow inputs
- [Context Sharing](/docs/guides/context-sharing) - Share data between phases
- [Error Handling](/docs/guides/error-handling) - Handle failures gracefully
