---
title: agent-cli-sdk
description: TypeScript SDK for orchestrating AI CLI tools (Claude, Codex, Gemini)
---

import { Callout } from 'fumadocs-ui/components/callout';
import { Tabs, Tab } from 'fumadocs-ui/components/tabs';
import { AgentCmd } from '@/components/AgentCmd';

TypeScript SDK for orchestrating AI-powered CLI tools programmatically.

## Installation

```bash
npm install agent-cli-sdk
# or
pnpm add agent-cli-sdk
# or
yarn add agent-cli-sdk
```

<Callout type="info">
  Requires Node.js 22+ and at least one AI CLI tool (Claude Code, Codex, or Gemini).
</Callout>

## Quick Start

### Execute AI Commands

<Tabs items={['Claude', 'Codex', 'Gemini']}>
  <Tab value="Claude">
    ```typescript
    import { execute } from 'agent-cli-sdk';

    const result = await execute({
      tool: 'claude',
      prompt: 'List all TypeScript files in src/',
      workingDir: '/path/to/project',
      verbose: true,
      onEvent: ({ message }) => {
        if (message) console.log('Message:', message);
      }
    });

    console.log('Output:', result.data);
    ```
  </Tab>
  <Tab value="Codex">
    ```typescript
    import { execute } from 'agent-cli-sdk';

    const result = await execute({
      tool: 'codex',
      prompt: 'Refactor this function',
      workingDir: '/path/to/project',
      permissionMode: 'acceptEdits'
    });

    console.log('Session ID:', result.sessionId);
    ```
  </Tab>
  <Tab value="Gemini">
    ```typescript
    import { execute } from 'agent-cli-sdk';

    const result = await execute({
      tool: 'gemini',
      prompt: 'Analyze this codebase',
      workingDir: '/path/to/project'
    });

    console.log('Messages:', result.messages);
    ```
  </Tab>
</Tabs>

### Load Session History

```typescript
import { loadMessages } from 'agent-cli-sdk';

const messages = await loadMessages({
  tool: 'claude',
  sessionId: 'your-session-id',
  projectPath: '/path/to/project'
});

console.log(`Loaded ${messages.length} messages`);
messages.forEach(msg => {
  console.log(`[${msg.role}]:`, msg.content);
});
```

## API Reference

### `execute(options)`

Execute an AI CLI command programmatically with real-time callbacks.

**Parameters:**

```typescript
interface ExecuteOptions {
  tool: 'claude' | 'codex' | 'gemini' | 'cursor';
  prompt: string;
  workingDir?: string;
  timeout?: number;
  verbose?: boolean;
  json?: boolean;
  sessionId?: string;
  resume?: boolean;
  continue?: boolean;
  permissionMode?: 'default' | 'plan' | 'acceptEdits' | 'bypassPermissions';
  model?: string;
  images?: Array<{ path: string }>;
  onEvent?: (data: { raw: string; event: unknown; message: UnifiedMessage | null }) => void;
  onStdout?: (data: { raw: string; events: unknown[]; messages: UnifiedMessage[] }) => void;
  onStderr?: (chunk: string) => void;
  onError?: (error: Error) => void;
  onClose?: (exitCode: number) => void;
}
```

**Returns:** `Promise<ExecuteResult<T>>`

```typescript
interface ExecuteResult<T = unknown> {
  success: boolean;
  exitCode: number;
  sessionId: string;
  duration: number;
  messages: UnifiedMessage[];
  data: T; // Text output or parsed JSON
  error?: string;
}
```

**Example:**

```typescript
const result = await execute({
  tool: 'claude',
  prompt: 'Create a Button component',
  workingDir: './src/components',
  verbose: true,
  onEvent: ({ message }) => {
    if (message?.role === 'assistant') {
      console.log('AI:', message.content);
    }
  }
});

console.log('Success:', result.success);
console.log('Duration:', result.duration, 'ms');
```

### `loadMessages(options)`

Load and parse messages from an AI CLI session history.

**Parameters:**

```typescript
interface LoadMessagesOptions {
  tool: 'claude' | 'codex' | 'gemini' | 'cursor';
  sessionId: string;
  projectPath?: string;
}
```

**Returns:** `Promise<UnifiedMessage[]>`

**Example:**

```typescript
const messages = await loadMessages({
  tool: 'claude',
  sessionId: 'abc123',
  projectPath: process.cwd()
});

// Filter for tool uses
const toolUses = messages.filter(msg =>
  msg.content.some(block => block.type === 'tool_use')
);

console.log(`Found ${toolUses.length} tool uses`);
```

### `extractJSON(text, schema?)`

Extract and parse JSON from AI response text.

**Parameters:**

```typescript
function extractJSON<T = unknown>(
  text: string,
  schema?: ZodSchema<T>
): T | null
```

**Returns:** Parsed JSON object or `null` if no valid JSON found

**Example:**

```typescript
import { extractJSON } from 'agent-cli-sdk';
import { z } from 'zod';

const text = 'Here is the data: {"name": "John", "age": 30}';

// Without schema validation
const data = extractJSON(text);

// With Zod schema validation
const userSchema = z.object({
  name: z.string(),
  age: z.number()
});

const validatedData = extractJSON(text, userSchema);
console.log('Name:', validatedData?.name);
```

### `detectClaudeCli()` / `detectCodexCli()` / `detectGeminiCli()`

Detect installed AI CLI executables.

**Returns:** `string | null` - Path to CLI or null if not found

**Example:**

```typescript
import { detectClaudeCli, detectCodexCli, detectGeminiCli } from 'agent-cli-sdk';

const claudePath = detectClaudeCli();
if (!claudePath) {
  throw new Error('Claude CLI not found. Install from https://claude.ai/code');
}

const codexPath = detectCodexCli();
const geminiPath = detectGeminiCli();

console.log('Claude:', claudePath);
console.log('Codex:', codexPath);
console.log('Gemini:', geminiPath);
```

**Environment Variables:**
- `CLAUDE_CLI_PATH` - Custom path to Claude CLI
- `CODEX_CLI_PATH` - Custom path to Codex CLI
- `GEMINI_CLI_PATH` - Custom path to Gemini CLI

### `getCapabilities(agent)`

Query agent capabilities, supported tools, and models.

**Parameters:**

```typescript
type AgentType = 'claude' | 'codex' | 'gemini' | 'cursor';

interface AgentCapabilities {
  tools: string[];
  models: ModelInfo[];
  features: string[];
}

interface ModelInfo {
  id: string;
  name: string;
  provider: string;
  contextWindow?: number;
  maxOutputTokens?: number;
}
```

**Returns:** `Promise<AgentCapabilities>`

**Example:**

```typescript
import { getCapabilities } from 'agent-cli-sdk';

const caps = await getCapabilities('claude');

console.log('Available tools:', caps.tools);
console.log('Available models:', caps.models.map(m => m.id));
console.log('Supported features:', caps.features);
```

### `killProcess(pid, options?)`

Terminate a running agent process.

**Parameters:**

```typescript
interface KillProcessOptions {
  signal?: NodeJS.Signals;
  timeout?: number;
  force?: boolean;
}

interface KillProcessResult {
  success: boolean;
  signal?: NodeJS.Signals;
  error?: Error;
}
```

**Returns:** `Promise<KillProcessResult>`

**Example:**

```typescript
import { killProcess } from 'agent-cli-sdk';

const result = await killProcess(1234, {
  signal: 'SIGTERM',
  timeout: 5000,
  force: true // SIGKILL if timeout
});

if (result.success) {
  console.log('Process terminated');
} else {
  console.error('Failed to kill process:', result.error);
}
```

## Types

### `UnifiedMessage`

Standardized message format across AI tools.

```typescript
interface UnifiedMessage {
  id: string;
  role: 'user' | 'assistant';
  content: UnifiedContent[];
  timestamp: number;
  tool: 'claude' | 'codex' | 'gemini';
  usage?: {
    inputTokens: number;
    outputTokens: number;
    totalTokens: number;
    cacheReadTokens?: number;
  };
  _original?: unknown;
}

type UnifiedContent =
  | { type: 'text'; text: string }
  | { type: 'thinking'; thinking: string }
  | { type: 'tool_use'; id: string; name: string; input: unknown }
  | { type: 'tool_result'; tool_use_id: string; content: string; is_error?: boolean }
  | { type: 'slash_command'; name: string; args?: string[] };
```

### Provider Compatibility

SDK automatically normalizes provider-specific formats:

| Feature | Codex | Claude | Gemini | SDK Output |
|---------|-------|--------|--------|------------|
| Tool calls | `function_call` | `tool_use` | `tool_call` | `tool_use` |
| Tool results | `function_call_output` | `tool_result` | `tool_result` | `tool_result` |
| Tool names | `shell` | `Bash` | `run_shell_command` | `Bash` |
| Reasoning | `reasoning` event | `thinking` block | `thought` | `thinking` |
| Content | `input_text`/`output_text` | `text` | `text` | `text` |

## Advanced Usage

### Permission Modes

Control AI file operation permissions:

```typescript
// Auto-approve file edits
await execute({
  tool: 'claude',
  prompt: 'Refactor this code',
  permissionMode: 'acceptEdits'
});

// Read-only analysis
await execute({
  tool: 'claude',
  prompt: 'Analyze codebase',
  permissionMode: 'plan'
});

// Bypass all permissions (dangerous - isolated environments only)
await execute({
  tool: 'claude',
  prompt: 'Full automation',
  permissionMode: 'bypassPermissions'
});
```

**Permission Modes:**
- `default` - Standard interactive mode with prompts
- `plan` - Read-only mode, no file modifications
- `acceptEdits` - Auto-approve file edit operations
- `bypassPermissions` - Skip all permission checks (use with caution)

### Session Management

Resume or continue existing sessions:

```typescript
// Resume a previous session
const result = await execute({
  tool: 'claude',
  prompt: 'Continue the refactoring',
  sessionId: 'previous-session-id',
  resume: true
});

// Load session history
const messages = await loadMessages({
  tool: 'claude',
  sessionId: result.sessionId,
  projectPath: '/path/to/project'
});
```

### Event Streaming

Monitor AI execution in real-time:

```typescript
const result = await execute({
  tool: 'claude',
  prompt: 'Build the project',
  onEvent: ({ raw, event, message }) => {
    console.log('Raw JSONL:', raw);
    console.log('Parsed event:', event);
    if (message) {
      console.log('Message:', message);
    }
  },
  onStdout: ({ raw, events, messages }) => {
    console.log(`Received ${messages.length} messages`);
  },
  onStderr: (chunk) => {
    console.error('Error:', chunk);
  },
  onClose: (exitCode) => {
    console.log('Process exited:', exitCode);
  }
});
```

### JSON Extraction

Extract structured data from AI responses:

```typescript
interface PackageInfo {
  name: string;
  version: string;
  dependencies: string[];
}

const result = await execute<PackageInfo>({
  tool: 'claude',
  prompt: 'Analyze package.json and return JSON',
  json: true
});

if (typeof result.data === 'object' && result.data !== null) {
  console.log('Package:', result.data.name);
  console.log('Version:', result.data.version);
  console.log('Dependencies:', result.data.dependencies);
}
```

### Timeouts

Configure execution timeouts:

```typescript
const result = await execute({
  tool: 'claude',
  prompt: 'Long-running task',
  timeout: 600000 // 10 minutes
});
```

### Images (Claude Only)

Include images with prompts:

```typescript
const result = await execute({
  tool: 'claude',
  prompt: 'Analyze this screenshot',
  images: [
    { path: '/path/to/screenshot.png' }
  ]
});
```

## Error Handling

```typescript
try {
  const result = await execute({
    tool: 'claude',
    prompt: 'Do something',
    onError: (error) => {
      console.error('Execution error:', error);
    }
  });

  if (!result.success) {
    console.error('Command failed:', result.error);
    console.error('Exit code:', result.exitCode);
  }
} catch (error) {
  console.error('SDK error:', error);
}
```

## Session Storage Locations

Different AI tools store sessions in different locations:

**Claude:**
- Path: `~/.claude/projects/{encoded-path}/{sessionId}.jsonl`
- Format: JSONL (one event per line)
- Requires matching project path

**Codex:**
- Path: `~/.codex/sessions/YYYY/MM/DD/rollout-{timestamp}-{uuid}.jsonl`
- Format: JSONL
- Globally indexed (no project path needed)

**Gemini:**
- Path: `~/.gemini/sessions/session-{timestamp}-{uuid}.json`
- Format: JSON (not JSONL)
- Simple timestamp-UUID naming

## Troubleshooting

### CLI Not Found

```bash
# Set custom CLI paths
export CLAUDE_CLI_PATH=/path/to/claude
export CODEX_CLI_PATH=/path/to/codex
export GEMINI_CLI_PATH=/path/to/gemini

# Verify installation
which claude
which codex
which gemini
```

### Permission Errors

Use appropriate permission mode for your use case:

```typescript
// For automated workflows
await execute({
  tool: 'claude',
  prompt: 'Automated task',
  permissionMode: 'acceptEdits'
});
```

### Session Not Found

Ensure session ID and project path match:

```typescript
const messages = await loadMessages({
  tool: 'claude',
  sessionId: 'abc123',
  projectPath: '/exact/path/from/session' // Must match
});
```

## Related

- [agentcmd-workflows](/docs/reference/sdk-api) - Workflow SDK
- [Workflow Examples](/docs/examples) - Real-world examples
- [CLI Reference](/docs/reference/cli) - <AgentCmd /> CLI commands
